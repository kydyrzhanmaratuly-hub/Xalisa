<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–µ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ MyStat</title>
    <link rel="stylesheet" href="static.css">
    <style>
        .math-class { background-color: #fef3c7; border-color: #f59e0b; border-left: 5px solid; }
        .prog-class { background-color: #d1fae5; border-color: #10b981; border-left: 5px solid; }
        .science-class { background-color: #e0f2fe; border-color: #3b82f6; border-left: 5px solid; }
        .lang-class { background-color: #ede9fe; border-color: #8b5cf6; border-left: 5px solid; }
        .design-class { background-color: #ffe4e6; border-color: #f43f5e; border-left: 5px solid; }

        .class-block {
            padding: 8px;
            border-radius: 6px;
            margin: 1px 2px; /* –£–º–µ–Ω—å—à–∞–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –æ—Ç—Å—Ç—É–ø */
            font-size: 12px;
            line-height: 1.3;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            z-index: 10; 
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .class-block span {
            font-weight: 600;
            color: #1f2937;
            font-size: 0.9em;
        }
        .class-block small {
            color: #6b7280;
            font-size: 0.75em;
        }
        .material-link {
            font-size: 0.75em;
            color: #3b82f6;
            text-decoration: none;
        }
        
        /* –ê–î–ê–ü–¢–ê–¶–ò–Ø –ü–û–î 15-–ú–ò–ù–£–¢–ù–´–ï –°–õ–û–¢–´ (44 –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ * 15px) */
        .schedule-grid {
            grid-column: 2 / 9;
            grid-row: 2;
            display: grid;
            grid-template-columns: repeat(7, 1fr); 
            /* 44 —Å–ª–æ—Ç–∞ –ø–æ 15 –º–∏–Ω—É—Ç (—Å 7:00 –¥–æ 18:00) */
            grid-template-rows: repeat(44, 15px); 
            position: relative;
            /* –õ–∏–Ω–∏–∏ —Å–µ—Ç–∫–∏ –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç */
            background-image: linear-gradient(to bottom, #eee 1px, transparent 1px);
            background-size: 100% 15px; 
            overflow: hidden;
        }

        .time-column {
            grid-template-rows: repeat(44, 15px); 
        }
        
        /* –ù–∞ 7:00, 8:00 –∏ —Ç.–¥. –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤—Ä–µ–º—è */
        .time-slot {
            height: 15px; 
            line-height: 15px;
            text-align: right;
            padding-right: 10px;
            font-size: 0.8em;
            color: #888;
            border-bottom: 1px solid #f0f0f0;
        }
    </style>
</head>
<body>
    <div class="header">
      <a href="https://kini.kz/en" target="_blank" rel="noopener noreferrer">
        <img src="Kini German.png" alt="–õ–æ–≥–æ—Ç–∏–ø" class="logo-image">
      </a>
        <div class="nav-links">
            <a href="static_cabinet.html" class="nav-button">–ú–æ–π –∫–∞–±–∏–Ω–µ—Ç</a>
            <a href="static_grades.html" class="nav-button">–¢–∞–±–µ–ª—å —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏</a>
            <a href="static.html" class="nav-button active">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</a>
            <a href="fafa.html" class="nav-button">–í—ã–π—Ç–∏</a>
        </div>
    </div>
    
    <div class="schedule-container">
        
        <h2 id="scheduleTitle" style="margin-bottom: 10px;">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è...</h2>
        <p id="scheduleMessage" style="color: red; font-weight: bold; margin: 20px 0;"></p>
        
        <div class="date-header">
            &lt; –û–∫—Ç—è–±—Ä—å 2025
            <span class="view-control">&gt;</span>
        </div>
        
        <div class="grid">
            <div class="time-column" id="timeColumn">
                </div>

            <div class="day-names">
                <div class="day"><br><span></span></div>
                <div class="day current-day">20<br><span>–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</span></div>
                <div class="day">21<br><span>–í—Ç–æ—Ä–Ω–∏–∫</span></div>
                <div class="day">22<br><span>–°—Ä–µ–¥–∞</span></div>
                <div class="day">23<br><span>–ß–µ—Ç–≤–µ—Ä–≥</span></div>
                <div class="day ">24<br><span>–ü—è—Ç–Ω–∏—Ü–∞</span></div>
                <div class="day weekend-day">25<br><span>–°—É–±–±–æ—Ç–∞</span></div>
                <div class="day weekend-day">26<br><span>–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ</span></div>
            </div>

            <div class="schedule-grid" id="scheduleGrid">
                </div>
        </div>
    </div>
    
<script>
    // –ö–∞—Ä—Ç–∞ –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏ —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏ CSS Grid (–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ = 1)
    const dayMap = {
        '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫': 1, '–í—Ç–æ—Ä–Ω–∏–∫': 2, '–°—Ä–µ–¥–∞': 3, '–ß–µ—Ç–≤–µ—Ä–≥': 4, '–ü—è—Ç–Ω–∏—Ü–∞': 5
    };

    /**
     * –í—ã—á–∏—Å–ª—è–µ—Ç –∏–Ω–¥–µ–∫—Å —Å—Ç—Ä–æ–∫–∏ –≤ CSS Grid –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ä–µ–º–µ–Ω–∏, –∏—Å–ø–æ–ª—å–∑—É—è 15-–º–∏–Ω—É—Ç–Ω—ã–µ —Å–ª–æ—Ç—ã.
     * @param {string} time - –í—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ "HH:MM"
     * @param {string[]} timeSlots - –ú–∞—Å—Å–∏–≤ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤, –ø—Ä–∏—à–µ–¥—à–∏—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞
     * @returns {number|null} –ò–Ω–¥–µ–∫—Å —Å—Ç—Ä–æ–∫–∏ –≤ Grid (–Ω–∞—á–∏–Ω–∞—è —Å 1)
     */
    function getTimeSlotIndex(time, timeSlots) {
        // –ù–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å –≤—Ä–µ–º–µ–Ω–∏ –≤ –º–∞—Å—Å–∏–≤–µ (0 –¥–ª—è 7:00, 1 –¥–ª—è 7:15 –∏ —Ç.–¥.)
        const index = timeSlots.findIndex(slot => slot === time);
        // –ò–Ω–¥–µ–∫—Å—ã —Å—Ç—Ä–æ–∫ –≤ schedule-grid –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å 1
        return index !== -1 ? index + 1 : null; 
    }
    
    /**
     * –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.
     * @param {Object[]} scheduleItems - –ú–∞—Å—Å–∏–≤ –ø—Ä–µ–¥–º–µ—Ç–æ–≤.
     * @param {string[]} timeSlots - –ú–∞—Å—Å–∏–≤ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ (15-–º–∏–Ω—É—Ç–Ω—ã—Ö) —Å —Å–µ—Ä–≤–µ—Ä–∞.
     */
    function renderSchedule(scheduleItems, timeSlots, userGroup) {
        const timeColumn = document.getElementById('timeColumn');
        const grid = document.getElementById('scheduleGrid');
        
        timeColumn.innerHTML = '';
        grid.innerHTML = '';

        // 1. –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã –≤ time-column
        timeSlots.forEach((slot, index) => {
            // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–ª–æ—Ç 18:00, —Ç.–∫. –æ–Ω –æ–±–æ–∑–Ω–∞—á–∞–µ—Ç –∫–æ–Ω–µ—Ü –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —á–∞—Å–∞
            if (index >= timeSlots.length - 1) return;
            
            const timeDiv = document.createElement('div');
            timeDiv.className = 'time-slot';
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Ä–µ–º—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª–Ω—ã—Ö —á–∞—Å–æ–≤ (7:00, 8:00 –∏ —Ç.–¥.)
            if (slot.endsWith(':00')) {
                 timeDiv.textContent = slot;
            } else {
                 timeDiv.textContent = '';
            }
            timeColumn.appendChild(timeDiv); 
        });
        
        // 2. –î–æ–±–∞–≤–ª—è–µ–º —è—á–µ–π–∫–∏ —Å –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏
        scheduleItems.forEach(item => {
            const startRow = getTimeSlotIndex(item.start, timeSlots);
            const endRow = getTimeSlotIndex(item.end, timeSlots);
            const col = dayMap[item.day];

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—Ä–µ–¥–º–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Å–µ—Ç–∫–∏
            if (startRow !== null && endRow !== null && col && endRow <= timeSlots.length) {
                const block = document.createElement('div');
                block.className = `class-block ${item.type}`;
                block.style.gridColumn = col;
                // Span = –∫–æ–Ω–µ—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ - –Ω–∞—á–∞–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞. –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ = 15 –º–∏–Ω.
                block.style.gridRow = `${startRow} / span ${endRow - startRow}`; 
                
                block.innerHTML = `
                    <span>${item.subject}</span>
                    <a href="#" class="material-link">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã —Å–∞–π—Ç–∞</a>
                    <small>${item.start} - ${item.end} | ${item.room}</small>
                `;
                grid.appendChild(block);
            }
        });
        
        // 3. –î–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫–∏ –¥–ª—è –≤—ã—Ö–æ–¥–Ω—ã—Ö –∏ –æ–≤–µ—Ä–ª–µ–π —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è
        const numRows = timeSlots.length; 
        
        const weekendBlock = document.createElement('div');
        weekendBlock.className = 'weekend-block';
        weekendBlock.style.gridColumn = '6 / span 2'; // –°—É–±–±–æ—Ç–∞ (6) –∏ –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ (7)
        weekendBlock.style.gridRow = `1 / ${numRows}`; 
        grid.appendChild(weekendBlock);
        
        const currentDayOverlay = document.createElement('div');
        currentDayOverlay.className = 'current-day-overlay';
        currentDayOverlay.style.gridColumn = '1'; // –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
        currentDayOverlay.style.gridRow = `1 / ${numRows}`;
        grid.appendChild(currentDayOverlay);
    }

    /**
     * –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–∞ (server.js)
     */
    async function loadSchedule() {
        const messageElement = document.getElementById('scheduleMessage');
        const titleElement = document.getElementById('scheduleTitle');
        const userDataString = localStorage.getItem('userData');
        
        let userGroup = null;
        
        if (userDataString) {
            try {
                const userData = JSON.parse(userDataString);
                userGroup = userData.group;
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ userData –∏–∑ localStorage:", e);
            }
        }
        
        // üí° –õ–æ–≥–∏–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞ (–µ—Å–ª–∏ –Ω–µ –≤–æ—à–ª–∏, –Ω–æ –ª–æ–≥–∏–Ω Yerkebulan)
        if (!userGroup && localStorage.getItem('login') === "Yerkebulan") { 
            userGroup = '–ò–°-204'; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥—Ä—É–ø–ø—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Ç–µ—Å—Ç–∞
        } 
        
        if (!userGroup) {
            titleElement.textContent = "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ";
            messageElement.textContent = "–û—à–∏–±–∫–∞: –î–∞–Ω–Ω—ã–µ –æ –≤–∞—à–µ–π –≥—Ä—É–ø–ø–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –í–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞.";
            return;
        }

        titleElement.textContent = `–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –≥—Ä—É–ø–ø—ã ${userGroup}...`;
        messageElement.textContent = "";

        const apiUrl = `http://localhost:3000/api/schedule/${encodeURIComponent(userGroup)}`;

        try {
            const response = await fetch(apiUrl);
            const data = await response.json();

            if (!response.ok) {
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ 404 (–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ) –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –æ—à–∏–±–æ–∫ —Å–µ—Ä–≤–µ—Ä–∞
                throw new Error(data.message || `–û—à–∏–±–∫–∞ HTTP: ${response.status} –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è`);
            }

            // –£—Å–ø–µ—Ö
            titleElement.textContent = `–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ`;
            renderSchedule(data.schedule, data.timeSlots, userGroup);

        } catch (error) {
            titleElement.textContent = "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ";
            messageElement.textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
            console.error(error);
        }
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –ø—Ä–∏ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', loadSchedule);
</script>
</body>
</html>
<!-- üìÖ –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è -->
<div class="calendar-toggle">
  <button id="openCalendarBtn">üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å</button>
</div>

<!-- üìÜ –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è -->
<div class="calendar-wrapper" id="calendarWrapper" style="display: none;">
  <div class="calendar-header">
    <h3 id="calendarTitle"></h3>
    <div>
      <button id="prevMonthBtn">&#9664;</button>
      <button id="nextMonthBtn">&#9654;</button>
      <button id="closeCalendarBtn" class="close-btn">‚úñ</button>
    </div>
  </div>
  <div class="calendar-grid" id="calendarGrid"></div>
</div>

<style>
  /* –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è */
  .calendar-toggle {
    position: absolute;
    top: 85px;
    right: 40px;
    z-index: 40;
  }
  .calendar-toggle button {
    background: #0078D7;
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 6px 12px;
    font-size: 0.9em;
    cursor: pointer;
    transition: background 0.3s;
  }
  .calendar-toggle button:hover {
    background: #005fa3;
  }

  /* –û–∫–Ω–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è */
  .calendar-wrapper {
    position: absolute;
    top: 130px;
    right: 40px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    width: 280px;
    padding: 15px;
    font-family: "Segoe UI", sans-serif;
    z-index: 50;
  }

  .calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }
  .calendar-header h3 {
    font-size: 1em;
    margin: 0;
    color: #1f2937;
  }
  .calendar-header button {
    background: #0078D7;
    border: none;
    color: #fff;
    border-radius: 6px;
    padding: 4px 8px;
    cursor: pointer;
    transition: background 0.3s;
    margin-left: 2px;
  }
  .calendar-header button:hover {
    background: #005fa3;
  }
  .close-btn {
    background: #ef4444 !important;
  }
  .close-btn:hover {
    background: #dc2626 !important;
  }

  .calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    text-align: center;
    gap: 4px;
  }
  .calendar-grid div {
    padding: 5px 0;
    border-radius: 6px;
    font-size: 12px;
    color: #374151;
  }
  .day-name {
    font-weight: bold;
    color: #0078D7;
  }
  .calendar-day:hover {
    background: #e5f0ff;
    cursor: pointer;
  }
  .today {
    background: #0078D7;
    color: white;
    font-weight: bold;
  }
</style>

<script>
  const calWrapper = document.getElementById("calendarWrapper");
  const openBtn = document.getElementById("openCalendarBtn");
  const closeBtn = document.getElementById("closeCalendarBtn");
  const calGrid = document.getElementById("calendarGrid");
  const calTitle = document.getElementById("calendarTitle");
  const prevMonthBtn = document.getElementById("prevMonthBtn");
  const nextMonthBtn = document.getElementById("nextMonthBtn");

  const monthNames = [
    "–Ø–Ω–≤–∞—Ä—å","–§–µ–≤—Ä–∞–ª—å","–ú–∞—Ä—Ç","–ê–ø—Ä–µ–ª—å","–ú–∞–π","–ò—é–Ω—å",
    "–ò—é–ª—å","–ê–≤–≥—É—Å—Ç","–°–µ–Ω—Ç—è–±—Ä—å","–û–∫—Ç—è–±—Ä—å","–ù–æ—è–±—Ä—å","–î–µ–∫–∞–±—Ä—å"
  ];
  const dayNames = ["–ü–Ω","–í—Ç","–°—Ä","–ß—Ç","–ü—Ç","–°–±","–í—Å"];

  let current = new Date();

  function renderMiniCalendar() {
    const y = current.getFullYear();
    const m = current.getMonth();
    calTitle.textContent = `${monthNames[m]} ${y}`;
    calGrid.innerHTML = "";

    dayNames.forEach(d => {
      const div = document.createElement("div");
      div.textContent = d;
      div.className = "day-name";
      calGrid.appendChild(div);
    });

    const first = new Date(y, m, 1);
    const last = new Date(y, m + 1, 0);
    const startDay = (first.getDay() + 6) % 7;

    for (let i = 0; i < startDay; i++) {
      const empty = document.createElement("div");
      calGrid.appendChild(empty);
    }

    for (let d = 1; d <= last.getDate(); d++) {
      const div = document.createElement("div");
      div.textContent = d;
      div.className = "calendar-day";
      const today = new Date();
      if (
        d === today.getDate() &&
        m === today.getMonth() &&
        y === today.getFullYear()
      ) {
        div.classList.add("today");
      }
      calGrid.appendChild(div);
    }
  }

  prevMonthBtn.addEventListener("click", () => {
    current.setMonth(current.getMonth() - 1);
    renderMiniCalendar();
  });
  nextMonthBtn.addEventListener("click", () => {
    current.setMonth(current.getMonth() + 1);
    renderMiniCalendar();
  });
  openBtn.addEventListener("click", () => {
    calWrapper.style.display = "block";
    renderMiniCalendar();
  });
  closeBtn.addEventListener("click", () => {
    calWrapper.style.display = "none";
  });

  // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
  document.addEventListener("click", (e) => {
    if (
      !calWrapper.contains(e.target) &&
      !openBtn.contains(e.target)
    ) {
      calWrapper.style.display = "none";
    }
  });
</script>
