<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Регистрация</title>
  <link rel="stylesheet" href="Registration.css">
</head>
<body>
  <div class="register-container">
    <form class="register-form" id="registrationForm">
        <h1 id="reg-title">Регистрация</h1>

        <label for="fullName" id="label-name">Полное имя</label>
        <input type="text" id="fullName" placeholder="Например: Еркебулан Смаилов" required
               data-placeholder-ru="Например: Еркебулан Смаилов" 
               data-placeholder-kz="Мысалы: Еркебұлан Смаилов" 
               data-placeholder-en="E.g.: Yerkebulan Smailov">
        
        <label for="login" id="label-login">Логин</label>
        <input type="text" id="login" placeholder="Введите логин" required
               data-placeholder-ru="Введите логин" 
               data-placeholder-kz="Логинді енгізіңіз" 
               data-placeholder-en="Enter login">

        <label for="password" id="label-password">Пароль</label>
        <input type="password" id="password" placeholder="Введите пароль" required
               data-placeholder-ru="Введите пароль" 
               data-placeholder-kz="Құпия сөзді енгізіңіз" 
               data-placeholder-en="Enter password">
               
        <label for="email" id="label-email">Email</label>
        <input type="email" id="email" placeholder="Ваша почта" required
               data-placeholder-ru="Ваша почта" 
               data-placeholder-kz="Электрондық поштаңыз" 
               data-placeholder-en="Your email">
               
        <label for="group" id="label-group">Группа</label>
        <input type="text" id="group" placeholder="Например: ИС-204" required
               data-placeholder-ru="Например: ИС-204" 
               data-placeholder-kz="Мысалы: АТ-201" 
               data-placeholder-en="E.g.: IS-204">
               
        <label for="course" id="label-course">Курс</label>
        <input type="number" id="course" placeholder="Например: 3" required min="1" max="5"
               data-placeholder-ru="Например: 3" 
               data-placeholder-kz="Мысалы: 3" 
               data-placeholder-en="E.g.: 3">
        
        <div class="agreement">
            <input type="checkbox" id="agree" required>
            <label for="agree" id="label-agree">Я согласен на обработку персональных данных</label>
        </div>

        <p id="registrationMessage" class="error-message"></p>
        <button type="submit" class="register-btn" id="register-button">Зарегистрироваться</button>
    </form>
</div>

<script>
    // --- ЛОКАЛИЗАЦИЯ ---
    const translations = {
        'KZ': {
            'reg-title': 'Тіркелу',
            'label-name': 'Толық аты-жөні',
            'label-login': 'Логин',
            'label-password': 'Құпия сөз',
            'label-email': 'Электрондық пошта',
            'label-group': 'Топ',
            'label-course': 'Курс',
            'label-agree': 'Мен дербес деректерді өңдеуге келісемін',
            'register-button': 'Тіркелу',
            'fill-fields': 'Барлық өрістерді толтырып, шарттармен келісіңіз.',
            'server-conn-error': 'Серверге қосылу қатесі. server.js файлын тексеріңіз.',
        },
        'RU': {
            'reg-title': 'Регистрация',
            'label-name': 'Полное имя',
            'label-login': 'Логин',
            'label-password': 'Пароль',
            'label-email': 'Email',
            'label-group': 'Группа',
            'label-course': 'Курс',
            'label-agree': 'Я согласен на обработку персональных данных',
            'register-button': 'Зарегистрироваться',
            'fill-fields': 'Пожалуйста, заполните все поля и согласитесь с условиями.',
            'server-conn-error': 'Ошибка подключения к серверу. Проверьте server.js.',
        },
        'EN': {
            'reg-title': 'Registration',
            'label-name': 'Full Name',
            'label-login': 'Login',
            'label-password': 'Password',
            'label-email': 'Email',
            'label-group': 'Group',
            'label-course': 'Course',
            'label-agree': 'I agree to the processing of personal data',
            'register-button': 'Register',
            'fill-fields': 'Please fill all fields and agree to the terms.',
            'server-conn-error': 'Server connection error. Check server.js.',
        }
    };
    function setLanguage(lang) {
        // Keep language key consistent across the app
        localStorage.setItem('currentLanguage', lang);
        const langData = translations[lang] || translations['RU'];

        for (const id in langData) {
            const element = document.getElementById(id);
            if (element) {
                if (element.tagName === 'INPUT') {
                    const placeholderKey = `data-placeholder-${lang.toLowerCase()}`;
                    const ph = element.getAttribute(placeholderKey);
                    if (ph) element.placeholder = ph;
                } else if (element.tagName === 'BUTTON') {
                    element.textContent = langData[id];
                } else {
                    element.textContent = langData[id];
                }
            }
        }
        document.title = langData['reg-title'];
    }

    // При загрузке: берем параметр ?lang или хранимый выбор в localStorage
    document.addEventListener('DOMContentLoaded', () => {
        const urlParams = new URLSearchParams(window.location.search);
        const urlLang = urlParams.get('lang');
        const savedLang = urlLang || localStorage.getItem('currentLanguage') || 'RU';
        setLanguage(savedLang);
    });

    // --- СЕРВЕРНАЯ РЕГИСТРАЦИЯ ---
    document.getElementById("registrationForm").addEventListener("submit", async function(event) {
        event.preventDefault(); 

        const name = document.getElementById("fullName").value.trim();
        const login = document.getElementById("login").value.trim();
        const password = document.getElementById("password").value.trim();
        const email = document.getElementById("email").value.trim();
        const group = document.getElementById("group").value.trim();
        const course = document.getElementById("course").value.trim();
        const agree = document.getElementById("agree").checked;
        const messageElement = document.getElementById("registrationMessage");

        messageElement.textContent = "";
        messageElement.style.color = "red";

        const curLang = localStorage.getItem('currentLanguage') || 'RU';
        const L = translations[curLang] || translations['RU'];

        if (!name || !login || !password || !email || !group || !course || !agree) {
            messageElement.textContent = L['fill-fields'];
            return;
        }
        
        try {
            const response = await fetch("http://localhost:3000/register", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name, login, password, email, group, course: parseInt(course) })
            });

            const data = await response.json();

            if (response.ok) {
                messageElement.style.color = "green";
                messageElement.textContent = data.message || '';
                
                setTimeout(() => {
                    const langParam = localStorage.getItem('currentLanguage') || 'RU';
                    window.location.href = `fafa.html?lang=${langParam}`;
                }, 2000); 

            } else {
                messageElement.textContent = data.message || (L['server-conn-error'] || 'Ошибка при регистрации.');
            }
        } catch (error) {
            const cur = localStorage.getItem('currentLanguage') || 'RU';
            const L2 = translations[cur] || translations['RU'];
            messageElement.textContent = L2['server-conn-error']; 
            console.error("Fetch error:", error);
        }
    });

</script>
</body>
</html>
